<!DOCTYPE html>
<html lang="en" dir="auto" data-theme="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>If my java memory serves me well... | Tales Of Details</title>
<meta name="keywords" content="">
<meta name="description" content="You&rsquo;ve got a backend in Java deployed in k8s and every once in a while it OOMs.
What a surprise :-P
How do you go about fixing this?
Well, give it more memory since it&rsquo;s out!
About half the time this will help.
But in case you&rsquo;re not lucky and you need to fix the underlying issue, let&rsquo;s take the engineering way around.
It&rsquo;s full of twists, turns and wasted time.
But if you need it, it&rsquo;s indispensable.">
<meta name="author" content="
stelis">
<link rel="canonical" href="https://details.systematize.it/details/2025-12-13-if-my-java-memory-serves-me-well/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.da3211e5ef867bf2b75fd5a6515cfed7195c011e8ab735694e203810a827097b.css" integrity="sha256-2jIR5e&#43;Ge/K3X9WmUVz&#43;1xlcAR6KtzVpTiA4EKgnCXs=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://details.systematize.it/assets/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://details.systematize.it/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://details.systematize.it/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://details.systematize.it/apple-touch-icon.png">
<link rel="mask-icon" href="https://details.systematize.it/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://details.systematize.it/details/2025-12-13-if-my-java-memory-serves-me-well/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
                color-scheme: dark;
            }

            .list {
                background: var(--theme);
            }

            .toc {
                background: var(--entry);
            }
        }

        @media (prefers-color-scheme: light) {
            .list::-webkit-scrollbar-thumb {
                border-color: var(--code-bg);
            }
        }

    </style>
</noscript>
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.querySelector("html").dataset.theme = 'dark';
    } else if (localStorage.getItem("pref-theme") === "light") {
       document.querySelector("html").dataset.theme = 'light';
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.querySelector("html").dataset.theme = 'dark';
    } else {
        document.querySelector("html").dataset.theme = 'light';
    }

</script><meta property="og:url" content="https://details.systematize.it/details/2025-12-13-if-my-java-memory-serves-me-well/">
  <meta property="og:site_name" content="Tales Of Details">
  <meta property="og:title" content="If my java memory serves me well...">
  <meta property="og:description" content="You’ve got a backend in Java deployed in k8s and every once in a while it OOMs.
What a surprise :-P
How do you go about fixing this?
Well, give it more memory since it’s out!
About half the time this will help.
But in case you’re not lucky and you need to fix the underlying issue, let’s take the engineering way around.
It’s full of twists, turns and wasted time.
But if you need it, it’s indispensable.">
  <meta property="og:locale" content="en-us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="details">
    <meta property="article:published_time" content="2025-12-13T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-12-13T00:00:00+00:00">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="If my java memory serves me well...">
<meta name="twitter:description" content="You&rsquo;ve got a backend in Java deployed in k8s and every once in a while it OOMs.
What a surprise :-P
How do you go about fixing this?
Well, give it more memory since it&rsquo;s out!
About half the time this will help.
But in case you&rsquo;re not lucky and you need to fix the underlying issue, let&rsquo;s take the engineering way around.
It&rsquo;s full of twists, turns and wasted time.
But if you need it, it&rsquo;s indispensable.">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Details",
      "item": "https://details.systematize.it/details/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "If my java memory serves me well...",
      "item": "https://details.systematize.it/details/2025-12-13-if-my-java-memory-serves-me-well/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "If my java memory serves me well...",
  "name": "If my java memory serves me well...",
  "description": "You\u0026rsquo;ve got a backend in Java deployed in k8s and every once in a while it OOMs.\nWhat a surprise :-P\nHow do you go about fixing this?\nWell, give it more memory since it\u0026rsquo;s out!\nAbout half the time this will help.\nBut in case you\u0026rsquo;re not lucky and you need to fix the underlying issue, let\u0026rsquo;s take the engineering way around.\nIt\u0026rsquo;s full of twists, turns and wasted time.\nBut if you need it, it\u0026rsquo;s indispensable.\n",
  "keywords": [
    
  ],
  "articleBody": "You’ve got a backend in Java deployed in k8s and every once in a while it OOMs.\nWhat a surprise :-P\nHow do you go about fixing this?\nWell, give it more memory since it’s out!\nAbout half the time this will help.\nBut in case you’re not lucky and you need to fix the underlying issue, let’s take the engineering way around.\nIt’s full of twists, turns and wasted time.\nBut if you need it, it’s indispensable.\nOK, first of all let’s get some ground terminology right.\nAfter all Java memory management is a deep topic.\nHere is an article from Baeldung giving us the high level overview.\nOne issue I’ve seen is that when deploying Java apps we seem focused on providing enough Heap memory.\nThe rest of the areas usually don’t get as much attention.\nThe official recommendation is to define max heap as a percentage of total memory available.\nAfter all, Java has been container aware since 11 and can detect how much RAM it’s been allocated by the deployment. So we can skip the hardcoding of xms , xmx and aim to provide 3/4 of total ram to heap.\nIt’s also a good practice to set minMemory=maxMemory.\nMore info and specific variables to use here.\nThis alone might save you if inadvertently your settings were starving some memory area other than heap.\nBut we better start gathering some data on these areas and their usage.\nIn short ( more details here) we’d need to install, enable and expose a prometheus monitoring endpoint.\nThen scrape the data and push it to a prometheus instance to be consumed by a Grafana dashboard.\nA short guide can be found here.\nAlternatively, one might like to try Grafana Cloud. I’ve lately grown very fond of their free tier, which has gotten me very far in a few situations.\nSo now we have our dashboards and can be sure all the memory areas are getting enough memory, or which it is that may be headed for issues.\nWe’re already in a much better ( or at least more observable) state than before.\nBut what happens if a couple of months forward you still get OOMs and you have no clue why?\nProfiling. It used to be a tool for a break-glass kind of situation. Enable and expose JMX, then connect with a compatible client to see where the memory is being allocated. With tools like pyroscope this can be continuous.\npyroscope’s agent needs to be installed and configured for your service ( quickstart here ). It then sends data to its server component, which produces flamegraphs. What answers can these graphs provide?\nDuring some period of time how much memory was allocated and which functions called for its allocation, in a hierarchical order?\nThis should get you pretty far in determining what caused the OOM.\nI’m sure there’s so much more nuance to the subject than what’s mentioned above. But as a very high level overview for an Ops perspective, I can hope it’s useful and (especially if found during an investigation) will leave you in a somewhat better place than it found you :-)\n",
  "wordCount" : "525",
  "inLanguage": "en",
  "datePublished": "2025-12-13T00:00:00Z",
  "dateModified": "2025-12-13T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": {"email":"stelis@systematize.it","name":"stelis"}
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://details.systematize.it/details/2025-12-13-if-my-java-memory-serves-me-well/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Tales Of Details",
    "logo": {
      "@type": "ImageObject",
      "url": "https://details.systematize.it/assets/favicon.ico"
    }
  }
}
</script>
</head>
<body id="top">
    <header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://details.systematize.it/" accesskey="h" title="Tales Of Details (Alt + H)">Tales Of Details</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://details.systematize.it/">Home</a>&nbsp;»&nbsp;<a href="https://details.systematize.it/details/">Details</a></div>
    <h1 class="post-title entry-hint-parent">
      If my java memory serves me well...
    </h1>
    <div class="post-meta"><span title='2025-12-13 00:00:00 +0000 UTC'>December 13, 2025</span>&nbsp;·&nbsp;<span>
<a href="mailto:stelis@systematize.it">stelis</a></span>

</div>
  </header> 
  <div class="post-content"><p>You&rsquo;ve got a backend in Java deployed in k8s and every once in a while it OOMs.<br>
What a surprise :-P</p>
<p>How do you go about fixing this?<br>
Well, give it more memory since it&rsquo;s out!<br>
About half the time this will help.<br>
But in case you&rsquo;re not lucky and you need to fix the underlying issue, let&rsquo;s take the engineering way around.<br>
It&rsquo;s full of twists, turns and <em>wasted</em> time.<br>
But if you need it, it&rsquo;s indispensable.</p>
<p>OK, first of all let&rsquo;s get some ground terminology right.<br>
After all Java memory management is a deep topic.<br>
<a href="https://www.baeldung.com/java-jvm-memory-types" title="Here">Here</a> is an article from Baeldung giving us the high level overview.</p>
<p>One issue I&rsquo;ve seen is that when deploying Java apps we seem focused on providing enough Heap memory.<br>
The rest of the areas usually don&rsquo;t get as much attention.<br>
The official recommendation is to define max heap as a percentage of total memory available.<br>
After all, Java has been container aware since 11 and can detect how much RAM it&rsquo;s been allocated by the deployment. So we can skip the hardcoding of <code>xms</code> , <code>xmx</code> and aim to provide 3/4 of total ram to heap.<br>
It&rsquo;s also a good practice to set minMemory=maxMemory.<br>
More info and specific variables to use <a href="https://www.baeldung.com/java-jvm-parameters-rampercentage">here</a>.</p>
<p>This alone might save you if inadvertently your settings were starving some memory area other than heap.<br>
But we better start gathering some data on these areas and their usage.<br>
In short ( more details <a href="https://www.baeldung.com/spring-boot-prometheus">here</a>) we&rsquo;d need to install, enable and expose a prometheus monitoring endpoint.<br>
Then scrape the data and push it to a prometheus instance to be consumed by a Grafana dashboard.<br>
A short guide can be found <a href="https://medium.com/simform-engineering/revolutionize-monitoring-empowering-spring-boot-applications-with-prometheus-and-grafana-e99c5c7248cf">here</a>.<br>
Alternatively, one might like to try Grafana Cloud. I&rsquo;ve lately grown very fond of their free tier, which has gotten me very far in a few situations.<br>
So now we have our dashboards and can be sure all the memory areas are getting enough memory, or which it is that may be headed for issues.</p>
<p>We&rsquo;re already in a much better ( or at least more observable) state than before.<br>
But what happens if a couple of months forward you still get OOMs and you have no clue why?<br>
<strong>Profiling</strong>. It used to be a tool for a break-glass kind of situation. Enable and expose JMX, then connect with a compatible client to see where the memory is being allocated. With tools like <code>pyroscope</code> this can be continuous.<br>
<code>pyroscope</code>&rsquo;s agent needs to be installed and configured for your service ( quickstart <a href="https://grafana.com/docs/pyroscope/latest/configure-client/language-sdks/java/#:~:text=To%20configure%20the%20Java%20SDK,to%20configure%20HTTP%20Basic%20authentication.">here</a> ). It then sends data to its server component, which produces <a href="https://grafana.com/docs/pyroscope/latest/introduction/flamegraphs/">flamegraphs</a>. What answers can these graphs provide?</p>
<p><code>During some period of time how much memory was allocated and which functions called for its allocation, in a hierarchical order?</code></p>
<p>This should get you pretty far in determining what caused the OOM.</p>
<p>I&rsquo;m sure there&rsquo;s so much more nuance to the subject than what&rsquo;s mentioned above. But as a very high level overview for an Ops perspective, I can hope it&rsquo;s useful and (especially if found during an investigation) will leave you in a somewhat better place than it found you :-)</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
<nav class="paginav">
  <a class="prev" href="https://details.systematize.it/details/2025-12-13-dev-ready-bare-metal-k8s/">
    <span class="title">« Prev</span>
    <br>
    <span>Dev Ready Bare Metal k8s</span>
  </a>
  <a class="next" href="https://details.systematize.it/details/2025-12-13-youre-allowed-to-not-know-everything/">
    <span class="title">Next »</span>
    <br>
    <span>You&#39;re allowed to not know everything</span>
  </a>
</nav>

  </footer><script src="https://utteranc.es/client.js"
        repo="stelispanagiotakis/details"
        issue-term="pathname"
        theme="preferred-color-scheme"
        crossorigin="anonymous"
        async>
</script>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2026 <a href="https://details.systematize.it/">Tales Of Details</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu');
    if (menu) {
        
        const scrollPosition = localStorage.getItem("menu-scroll-position");
        if (scrollPosition) {
            menu.scrollLeft = parseInt(scrollPosition, 10);
        }
        
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        const html = document.querySelector("html");
        if (html.dataset.theme === "dark") {
            html.dataset.theme = 'light';
            localStorage.setItem("pref-theme", 'light');
        } else {
            html.dataset.theme = 'dark';
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
